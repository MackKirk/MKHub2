<div class="side">
  <h3>MK Hub</h3>
  <div id="hello" class="muted"></div>
  <a href="/ui/home.html" id="nav-home">Home</a>
  <a href="/ui/profile.html" id="nav-profile">My Information</a>
  <a href="/ui/invite.html" id="nav-invite" data-perm="invite:send" style="display:none">Invite Users</a>
  <a href="/ui/users.html" id="nav-users" data-perm="users:read" style="display:none">Users</a>
  <button onclick="logout()">Logout</button>
</div>
<script>
function logout(){ localStorage.removeItem('user_token'); location.href='/ui/login.html'; }
const token = localStorage.getItem('user_token');
if(!token){ location.href='/ui/login.html'; }
fetch('/auth/me', { headers:{ Authorization:'Bearer '+token } })
  .then(r => { if (r.status === 401) { localStorage.removeItem('user_token'); location.href='/ui/login.html'; return null; } return r ? r.json() : null; })
  .then(u => {
    if (!u) return;
    const el=document.getElementById('hello'); if(el){ el.textContent = 'Hello, ' + (u.username || 'user'); }
    // Reveal links if user has permission or admin role
    const isAdmin = (u.roles||[]).includes('admin');
    const perms = new Set(u.permissions||[]);
    document.querySelectorAll('.side a[data-perm]').forEach(a => {
      const need = a.getAttribute('data-perm');
      if (isAdmin || (need && perms.has(need))) { a.style.display = 'block'; }
    });
  });
// Highlight active
const path = location.pathname;
for (const id of ['home','profile','invite']) {
  const el = document.getElementById('nav-'+id);
  if (el && path.endsWith(id+'.html')) { el.classList.add('active'); }
}
</script>

