<!doctype html>
<meta charset="utf-8">
<title>New Supplier</title>
<link rel="stylesheet" href="/ui/styles.css">
<script src="/ui/app.js"></script>
<script src="/ui/geo.js"></script>
<div id="sidebar"></div>
<div class="main">
  <h2>New Supplier</h2>
  <div class="card">
    <div class="row">
      <div class="field"><label>Name *</label><input id="name" required /></div>
      <div class="field"><label>Legal name</label><input id="legal_name" /></div>
    </div>
    <div class="row">
      <div class="field"><label>Email</label><input id="email" type="email" /></div>
      <div class="field"><label>Phone</label><input id="phone" /></div>
      <div class="field"><label>Website</label><input id="website" /></div>
    </div>
    <h4>Address</h4>
    <div class="row">
      <div class="field"><label>Street 1</label><input id="address_line1" /></div>
      <div class="field"><label>Street 2</label><input id="address_line2" /></div>
    </div>
    <div class="row">
      <div class="field"><label>Country</label>
        <select id="country"><option value="">Select...</option></select>
      </div>
      <div class="field"><label>Province/State</label>
        <select id="province"><option value="">Select...</option></select>
      </div>
    </div>
    <div class="row">
      <div class="field"><label>City</label>
        <select id="city"><option value="">Select...</option></select>
      </div>
      <div class="field"><label>Postal</label><input id="postal_code" /></div>
    </div>
    <h4>Commercial</h4>
    <div class="row">
      <div class="field"><label>Tax number</label><input id="tax_number" /></div>
      <div class="field"><label>Payment terms</label><input id="payment_terms" placeholder="e.g., Net 30" /></div>
    </div>
    <div class="row">
      <div class="field"><label>Currency</label><input id="currency" placeholder="e.g., CAD" /></div>
      <div class="field"><label>Lead time (days)</label><input id="lead_time_days" type="number" min="0" /></div>
    </div>
    <div class="row">
      <div class="field"><label>Category</label><input id="category" /></div>
      <div class="field"><label>Status</label>
        <select id="status"><option value="active">active</option><option value="paused">paused</option></select>
      </div>
    </div>
    <div class="row">
      <div class="field" style="flex:1"><label>Notes</label><input id="notes" /></div>
    </div>
    <div class="row">
      <button id="save">Create Supplier</button>
      <a class="btn" href="/ui/inventory-suppliers.html">Cancel</a>
    </div>
    <pre id="msg" class="muted"></pre>
  </div>
</div>
<script>
MKHubUI.initSidebar('inventory-suppliers');
document.getElementById('save').addEventListener('click', async ()=>{
  const token = MKHubUI.getTokenOrRedirect();
  const body = {
    name: document.getElementById('name').value.trim(),
    legal_name: document.getElementById('legal_name').value || null,
    email: document.getElementById('email').value || null,
    phone: document.getElementById('phone').value || null,
    website: document.getElementById('website').value || null,
    address_line1: document.getElementById('address_line1').value || null,
    address_line2: document.getElementById('address_line2').value || null,
    city: document.getElementById('city').value || null,
    province: document.getElementById('province').value || null,
    postal_code: document.getElementById('postal_code').value || null,
    country: document.getElementById('country').value || null,
    tax_number: document.getElementById('tax_number').value || null,
    payment_terms: document.getElementById('payment_terms').value || null,
    currency: document.getElementById('currency').value || null,
    lead_time_days: document.getElementById('lead_time_days').value || null,
    category: document.getElementById('category').value || null,
    status: document.getElementById('status').value || null,
    notes: document.getElementById('notes').value || null,
  };
  if (!body.name){ document.getElementById('msg').textContent = 'Name is required.'; return; }
  const r = await fetch('/inventory/suppliers', { method:'POST', headers:{ 'Content-Type':'application/json', Authorization:'Bearer '+token }, body: JSON.stringify(body) });
  const txt = await r.text();
  if (!r.ok){ document.getElementById('msg').textContent = txt; return; }
  location.href = '/ui/inventory-suppliers.html';
});

// Geo selects (reuse employee register logic)
(async function initGeo(){
  await (window.MKHubGeo && window.MKHubGeo.load ? window.MKHubGeo.load() : Promise.resolve());
  const countrySel = document.getElementById('country');
  const stateSel = document.getElementById('province');
  const citySel = document.getElementById('city');
  const countries = (window.MKHubGeo && window.MKHubGeo.data) || [];
  for (const c of countries){ const o=document.createElement('option'); o.value=c.name; o.textContent=c.name; countrySel.appendChild(o); }
  async function populateStates(country){
    stateSel.innerHTML = '<option value="">Select...</option>';
    citySel.innerHTML = '<option value="">Select...</option>';
    const states = window.MKHubGeo.getStates ? await window.MKHubGeo.getStates(country) : [];
    for (const s of states){ const o=document.createElement('option'); o.value=s; o.textContent=s; stateSel.appendChild(o); }
  }
  async function populateCities(country, state){
    citySel.innerHTML = '<option value="">Select...</option>';
    const cities = window.MKHubGeo.getCities ? await window.MKHubGeo.getCities(country, state) : [];
    for (const n of cities){ const o=document.createElement('option'); o.value=n; o.textContent=n; citySel.appendChild(o); }
  }
  countrySel.addEventListener('change', e=>populateStates(e.target.value));
  stateSel.addEventListener('change', ()=>populateCities(countrySel.value, stateSel.value));
})();
</script>


