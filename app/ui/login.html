<!doctype html>
<meta charset="utf-8">
<title>Login</title>
<link rel="stylesheet" href="/ui/login.css">
<div class="login-wrapper">
  <aside class="login-hero">
    <div class="hero-content">
      <div class="brand brand-large" style="gap:14px">
        <img src="/ui/assets/login/logo-light.svg" alt="Logo" onerror="this.style.display='none'">
      </div>
      <h1 class="hero-title">Welcome back!</h1>
      <p class="hero-sub">Mack Kirk Operations Hub â€” customers, proposals, inventory, and projects in one secure place.</p>
    </div>
  </aside>
  <section class="login-form">
    <div class="form-title">Sign in</div>
    <form onsubmit="login(event)">
      <div class="field">
        <img class="icon" src="/ui/assets/login/icons/mail.svg" alt="" onerror="this.style.display='none'">
        <input id="id" placeholder="Email or username" required />
      </div>
      <div class="field">
        <img class="icon" src="/ui/assets/login/icons/lock.svg" alt="" onerror="this.style.display='none'">
        <input id="pw" type="password" placeholder="Password" required />
      </div>
      <div class="actions">
        <label class="muted"><input id="remember" type="checkbox"> Remember me</label>
        <a class="link" href="#" onclick="forgot();return false;">Forgot password?</a>
      </div>
      <button class="btn-primary">Login</button>
      <pre id="out" class="muted" style="white-space:pre-wrap"></pre>
    </form>
    
  </section>
</div>
<script>
async function login(ev){
  ev.preventDefault();
  const idEl=document.getElementById('id');
  const pwEl=document.getElementById('pw');
  const out=document.getElementById('out');
  out.textContent='';
  try{
    const r = await fetch('/auth/login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({identifier:idEl.value,password:pwEl.value, remember_me: document.getElementById('remember').checked})
    });
    const j = await r.json();
    if(j && j.access_token){ localStorage.setItem('user_token', j.access_token); location.href='/home'; }
    else { out.textContent = (j && (j.detail||j.message)) ? (j.detail||j.message) : JSON.stringify(j,null,2); }
  }catch(e){ out.textContent = 'Failed to login'; }
}
function forgot(){
  const id = (document.getElementById('id').value||'').trim();
  if(!id){ alert('Enter username or email'); return; }
  fetch('/auth/password/forgot?identifier='+encodeURIComponent(id),{method:'POST'})
    .then(()=>{ alert('If the account exists, a reset email was sent.'); location.href='/ui/password-reset.html'; })
    .catch(()=>{});
}
</script>
