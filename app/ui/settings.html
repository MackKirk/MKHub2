<!doctype html>
<meta charset="utf-8">
<title>System Settings</title>
<link rel="stylesheet" href="/ui/styles.css">
<script src="/ui/app.js"></script>
<div id="sidebar"></div>
<div class="main">
  <h2>System Settings</h2>

  <div class="card">
    <h3>System Settings</h3>
    <p class="muted">Manage option lists used across the system.</p>
    <div id="lists" class="card"></div>
  </div>

  <div class="card">
    <h3>Developer Utilities</h3>
    <div class="row">
      <button id="mkEmployees">Create 10 Employees</button>
      <button id="mkCustomers">Create 10 Customers</button>
    </div>
    <pre class="muted" id="devMsg"></pre>
  </div>
</div>
<script>
MKHubUI.initSidebar('settings');
function auth(){ return { Authorization:'Bearer '+MKHubUI.getTokenOrRedirect() }; }
const SETTINGS = [
  { area: 'Customers', name: 'Client Types', key: 'client_types', description: 'Types of clients such as Residential or Commercial' },
  { area: 'Customers', name: 'Client Statuses', key: 'client_statuses', description: 'Lifecycle statuses such as Active, Prospect, Paused' },
  { area: 'Finance', name: 'Payment Terms', key: 'payment_terms', description: 'Standard payment terms like Net 30' },
  { area: 'Projects', name: 'Project Statuses', key: 'project_statuses', description: 'Statuses used in project workflows' },
  { area: 'Organization', name: 'Divisions', key: 'divisions', description: 'Company divisions or departments' },
  { area: 'Files', name: 'File Categories', key: 'file_categories', description: 'Categories to group uploaded files' },
];
function renderLists(){
  const byArea = {};
  for (const s of SETTINGS){ (byArea[s.area] ||= []).push(s); }
  const el = document.getElementById('lists');
  el.innerHTML = Object.keys(byArea).sort().map(area => {
    const items = byArea[area].map(s=>`<div style="display:flex;justify-content:space-between;border-bottom:1px solid #eee;padding:6px 0">`
      + `<div><strong>${s.name}</strong><div class=muted>${s.description}</div></div>`
      + `<div><a class="btn" href="/ui/settings-list.html?list=${encodeURIComponent(s.key)}">Edit</a></div>`
      + `</div>`).join('');
    return `<h4>${area}</h4><div class=card>${items}</div>`;
  }).join('');
}
renderLists();

// Developer Utilities - use auth APIs to create data quickly
document.getElementById('mkEmployees').addEventListener('click', async ()=>{
  const token = MKHubUI.getTokenOrRedirect();
  const base = 'seed'+Date.now();
  const r = await fetch(`/auth/admin/users/bulk-create?count=10&prefix=${encodeURIComponent(base)}&role=estimator`, { method:'POST', headers:{ Authorization:'Bearer '+token } });
  const txt = await r.text();
  document.getElementById('devMsg').textContent = r.ok ? 'Created 10 employees.' : txt;
});

document.getElementById('mkCustomers').addEventListener('click', async ()=>{
  const token = MKHubUI.getTokenOrRedirect();
  const base = 'CUST'+Date.now();
  const results = [];
  for (let i=1;i<=10;i++){
    const code = `${base}-${i}`;
    const display = `Test Customer ${i}`;
    try{
      const r = await fetch('/clients', { method:'POST', headers:{ 'Content-Type':'application/json', Authorization:'Bearer '+token }, body: JSON.stringify({ code, name: display, display_name: display, client_status: 'Active', client_type: 'Commercial' }) });
      const txt = await r.text();
      results.push(`${i}: ${r.status} ${r.ok ? 'OK' : txt}`);
    }catch(e){ results.push(`${i}: error ${e}`); }
  }
  document.getElementById('devMsg').textContent = results.join('\n');
});
</script>


